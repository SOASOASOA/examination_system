<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"      
 "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="cn.soa.examsystem.dao.UserManagementDao">
	<select id="findUserFunctionlByID" resultType="map"
		parameterType="string">
		select function_name,function_url,function_id from
		user_function where ua_id=#{ua_id}
	</select>
	<select id="findOrganizationStructureByUserId" resultType="cn.soa.examsystem.entity.Tree"
		parameterType="string">
		select uos_id as id,user_father_id as pid,user_name as
		name from user_oaganization_stucture m start with m.uos_id=(select
		uos_id from user_info where user_id=#{user_id}) connect by
		m.user_father_id=prior m.uos_id order by pid desc
	</select>
	<select id="findNodeOrganizationByUosId" resultType="map"
		parameterType="string">
		select a1.uos_id,a1.user_name,a2.user_name as fater_name
		from user_oaganization_stucture a1,user_oaganization_stucture a2 where
		a1.uos_id=#{uos_id} and a2.uos_id=a1.user_father_id
	</select>
	<update id="updateNodeNameByUosId" parameterType="string">
		update
		user_oaganization_stucture set user_name=#{1} where uos_id=#{0}
	</update>
	<insert id="addNode">
		insert into user_oaganization_stucture values
		(#{0},#{1},#{2})
	</insert>
	<select id="initUserTable" resultType="map" parameterType="string">
		select a1.uos_id,a1.user_name,a2.user_name as fater_name from
		user_oaganization_stucture a1,user_oaganization_stucture a2 where
		a1.uos_id=#{uos_id} and a2.uos_id=a1.user_father_id
	</select>
	<select id="findUserInfoByUserID" resultType="map">
		select * from (select rownum rn,a1.* from(select
		a1.user_id,a1.user_account,a1.user_name,a1.user_certificaiton_num,a1.user_company,decode(a1.user_account_state,1,'启用',0,'未启用','未启用')
		as user_account_state,a3.role_name from user_info a1,ui_ur_relation
		a2,user_role a3 where a1.USER_ID=a2.UI_ID and a2.UR_ID=a3.ROLE_ID and
		uos_id=(select uos_id from user_info where user_id=#{0}) order by
		USER_REGIST_TIME) a1
		where rownum<![CDATA[<=]]>#{2})
		where rn<![CDATA[>=]]>#{1}
	</select>
	<select id="findChildRoleByUserID" resultType="string"
		parameterType="string">
		select role_name from user_role m start with
		m.father_id=(select a3.role_id from user_info a1,ui_ur_relation
		a2,user_role a3 where a1.USER_ID=a2.UI_ID and a2.UR_ID=a3.ROLE_ID and
		a1.user_id=#{user_id}) connect by m.father_id=prior m.role_id
	</select>
	<select id="findUserInfoTotalCountByUserID" resultType="int"
		parameterType="string">
		select count(*) from user_info where uos_id=(select uos_id from user_info where user_id=#{user_id})
	</select>
	<select id="findUserInfoByUosID" resultType="map">
	select * from (select rownum rn,a1.* from(select
		a1.user_id,a1.user_account,a1.user_name,a1.user_certificaiton_num,a1.user_company,decode(a1.user_account_state,1,'启用',0,'未启用','未启用')
		as user_account_state,a3.role_name from user_info a1,ui_ur_relation
		a2,user_role a3 where a1.USER_ID=a2.UI_ID and a2.UR_ID=a3.ROLE_ID and
		uos_id=#{0} order by
		USER_REGIST_TIME) a1
		where rownum<![CDATA[<=]]>#{2})
		where rn<![CDATA[>=]]>#{1}
	</select>
	<select id="findUserInfoTotalCountByUosID" resultType="int"
		parameterType="string">
		select count(*) from user_info where uos_id=#{uos_id}
	</select>
</mapper>












